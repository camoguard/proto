{% load comments %}
{% load threadedcomments_tags %}
{% get_comment_count for object as comment_count %}
{{ comment_count }} Comments

{% get_comment_list for object as comment_list %}
<div id="comments">
{% for comment in comment_list|fill_tree|annotate_tree %}

    {% ifchanged comment.parent_id %}{% else %}
        </li>
    {% endifchanged %}

    {% if not comment.open and not comment.close %}
        </li>
    {% endif %}

    {% if comment.open %}
        <ul>
    {% endif %}

    <li{% if comment.last %} class="last"{% endif %}>

    {{ comment.user }} {{ comment.submit_date }}
    <p>{{ comment.comment }}</p>

    {% render_comment_form for object with comment.pk %}

    {% for close in comment.close %}
        </li>
        </ul>
    {% endfor %}

{% endfor %}
</div>

{% if request.user.is_authenticated %}
    {% render_comment_form for object %}
{% endif %}